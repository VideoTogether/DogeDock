!function(e){function t(t){for(var n,r,s=t[0],o=t[1],l=t[2],u=0,p=[];u<s.length;u++)r=s[u],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&p.push(i[r][0]),i[r]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);for(d&&d(t);p.length;)p.shift()();return c.push.apply(c,l||[]),a()}function a(){for(var e,t=0;t<c.length;t++){for(var a=c[t],n=!0,r=1;r<a.length;r++){var o=a[r];0!==i[o]&&(n=!1)}n&&(c.splice(t--,1),e=s(s.s=a[0]))}return e}var n={},r={2:0},i={2:0},c=[];function s(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.e=function(e){var t=[];r[e]?t.push(r[e]):0!==r[e]&&{1:1,3:1}[e]&&t.push(r[e]=new Promise((function(t,a){for(var n="css/"+({0:"404",1:"account",3:"app-details"}[e]||e)+"."+{0:"530074",1:"c166de",3:"b35a36"}[e]+".css",i=s.p+n,c=document.getElementsByTagName("link"),o=0;o<c.length;o++){var l=(d=c[o]).getAttribute("data-href")||d.getAttribute("href");if("stylesheet"===d.rel&&(l===n||l===i))return t()}var u=document.getElementsByTagName("style");for(o=0;o<u.length;o++){var d;if((l=(d=u[o]).getAttribute("data-href"))===n||l===i)return t()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=t,p.onerror=function(t){var n=t&&t.target&&t.target.src||i,c=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");c.code="CSS_CHUNK_LOAD_FAILED",c.request=n,delete r[e],p.parentNode.removeChild(p),a(c)},p.href=i,document.getElementsByTagName("head")[0].appendChild(p)})).then((function(){r[e]=0})));var a=i[e];if(0!==a)if(a)t.push(a[2]);else{var n=new Promise((function(t,n){a=i[e]=[t,n]}));t.push(a[2]=n);var c,o=document.createElement("script");o.charset="utf-8",o.timeout=120,s.nc&&o.setAttribute("nonce",s.nc),o.src=function(e){return s.p+"js/"+({0:"404",1:"account",3:"app-details"}[e]||e)+"."+{0:"530074",1:"c166de",3:"b35a36"}[e]+".js"}(e);var l=new Error;c=function(t){o.onerror=o.onload=null,clearTimeout(u);var a=i[e];if(0!==a){if(a){var n=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+n+": "+r+")",l.name="ChunkLoadError",l.type=n,l.request=r,a[1](l)}i[e]=void 0}};var u=setTimeout((function(){c({type:"timeout",target:o})}),12e4);o.onerror=o.onload=c,document.head.appendChild(o)}return Promise.all(t)},s.m=e,s.c=n,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(a,n,function(t){return e[t]}.bind(null,n));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s.oe=function(e){throw console.error(e),e};var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var u=0;u<o.length;u++)t(o[u]);var d=l;c.push([175,4]),a()}({158:function(e,t,a){},160:function(e,t,a){},168:function(e,t,a){},169:function(e,t,a){},170:function(e,t,a){},171:function(e,t,a){},172:function(e,t,a){},173:function(e,t,a){},175:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(69),c=a.n(i),s=a(17),o=a(21),l=a(80),u=a(81),d=a(70),p=a(71),h=a(72),m=a(73),f=a(74),v=a(82),y=a(75),g=a(83),E=a(76),C=a(84),T=a(85),b=a(79),I=a(86),_=a(77),w=a(48),A=a(49);o.a.use([l.a,u.a,d.a,p.a,w.a,h.a,m.a,f.a,v.a,y.a,g.a,E.a,C.a,T.a,b.a,I.a,A.a,_.a]);var P=o.a,S=(a(158),a(159),a(160),a(11)),D=a.n(S),k=a(15),L=a.n(k),x=a(22),O=a.n(x),U=a(27),M=a.n(U),R=a(78),N=a.n(R),j=Object(n.createContext)({state:{ChatList:[],My:{LibraryPlaylists:[]}},dispatch:function(){}}),H=a(2),K=a(63),W=a(67),F=a(57),Y=a(64),J=a(65),G=a(55),B=a(66),q=a(68),X=a(36),Q=a(28),z=a(53),V=a(54),Z=a(56),$={skipWaitingSent:!1,registration:null,serviceWorkerPendingUpdate:!1,listenForWaitingServiceWorker:function(e){function t(){e.installing.addEventListener("statechange",(function(){"installed"===this.state&&$.promptUserToRefresh(e)}))}e&&(e.waiting?$.promptUserToRefresh(e):(e.installing&&t(),e.addEventListener("updatefound",t)))},promptUserToRefresh:function(e){e&&e.waiting&&($.skipWaitingSent=!0,e.waiting.postMessage("skipWaiting"),$.serviceWorkerPendingUpdate=!0)},init:function(){var e;"serviceWorker"in window.navigator&&(window.navigator.serviceWorker.register("./service-worker.js",{scope:"/"}).then((function(e){$.registration=e,$.listenForWaitingServiceWorker(e)})),navigator.serviceWorker.addEventListener("controllerchange",(function(){!e&&$.skipWaitingSent&&(e=!0)})))}},ee=$,te=a(52),ae=a.n(te),ne=(a(168),function(e){var t=e.title,a=e.heading,n=e.accountLink,i=void 0===n||n;return(r.a.createElement("h1",{className:"appstore-page-title"},a&&r.a.createElement("div",{className:"appstore-page-title-heading"},a),r.a.createElement("span",null,t),i&&r.a.createElement(Q.a,{href:"/account/"},r.a.createElement("img",{src:ae.a,alt:"Account"}))))}),re=(a(169),function(e){var t=e.title,a=e.navbarHeading,n=e.noCollapsedNavbar,i=e.children;return(r.a.createElement(w.a,{className:"appstore-page ".concat(n?"appstore-page-no-collapsed-navbar":"")},t&&r.a.createElement(ne,{title:t,heading:a}),i))}),ie=(a(170),a(171),a(87),function(){return r.a.createElement(re,{title:"DogeDock"},r.a.createElement(Z.a,null,"Work in progress"))}),ce=a(178);function se(e){return"https://dogedock.2gether.video:5001"+e}var oe={Types:{REFRESH_CHAT_LIST:"REFRESH_CHAT_LIST",JOIN_CHAT:"JOIN_CHAT",UPDATE_CURRENT_CHAT_DETAIL:"UPDATE_CURRENT_CHAT_DETAIL",UPDATE_LIBRARY_PLAYLISTS:"UPDATE_LIBRARY_PLAYLISTS",OPEN_PLAYLIST:"OPEN_PLAYLIST",UPDATE_CURRENT_OPNED_PLAYLIST:"UPDATE_CURRENT_OPNED_PLAYLIST",UPDATE_MUSIC_PLAYER_DETAIL:"UPDATE_MUSIC_PLAYER_DETAIL",APPEND_CURRENT_CHAT_MESSAGE:"APPEND_CURRENT_CHAT_MESSAGE",UPDATE_USER_ID:"UPDATE_USER_ID",UPDATE_CURRENT_CHAT_SHOW:"UPDATE_CURRENT_CHAT_SHOW"},DispathUpdateChatListAction:function(e,t){t({type:this.Types.UPDATE_CHAT_LIST,data:e})},ExitChat:function(e){e({type:"EXIT_CHAT"})},JoinChat:function(e,t){var a=this;this.ExitChat(t),t({type:this.Types.JOIN_CHAT,data:{Id:e,ScheduledTaskId:setInterval((function(){a.FetchChatAsync(e,t)}),1e4)}}),this.FetchChatAsync(e,t)},UpdateMusicPlayerDetail:function(e,t,a,n){n({type:this.Types.UPDATE_MUSIC_PLAYER_DETAIL,data:{Progress:e,Name:t,Image:a}})},OpenPlaylistAsync:function(e,t){var a=this;return L()(D.a.mark((function n(){var r;return D.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t({type:a.Types.OPEN_PLAYLIST,data:e}),n.prev=1,n.next=4,MusicKit.getInstance().api.library.playlist(e);case 4:r=n.sent,t({type:a.Types.UPDATE_CURRENT_OPNED_PLAYLIST,data:r}),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(1),console.error(n.t0);case 11:case"end":return n.stop()}}),n,null,[[1,8]])})))()},CreateChatAsync:function(e,t,a,n){var r=this;return L()(D.a.mark((function a(){var i;return D.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,fetch(se("/chat/update"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Songs:e,Name:t})});case 2:return a.next=4,a.sent.json();case 4:i=a.sent,console.log(i),r.JoinChat(i.ID,n);case 7:case"end":return a.stop()}}),a)})))()},FetchChatAsync:function(e,t){var a=this;return L()(D.a.mark((function n(){var r;return D.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,fetch(se("/chat/get?id="+e));case 2:return n.next=4,n.sent.json();case 4:r=n.sent,t({type:a.Types.UPDATE_CURRENT_CHAT_DETAIL,data:r});case 6:case"end":return n.stop()}}),n)})))()},FetchMessageAsync:function(e,t,a){var n=this;return L()(D.a.mark((function r(){var i;return D.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,fetch(se("/message/get?ChatID=".concat(e,"&Offset=").concat(t)));case 2:return r.next=4,r.sent.json();case 4:i=r.sent,a({type:n.Types.APPEND_CURRENT_CHAT_MESSAGE,data:{ID:e,Messages:i}});case 6:case"end":return r.stop()}}),r)})))()},FetchChatList:function(e,t,a,n){this.DispathUpdateChatListAction([].concat(M()(a.ChatList),M()(Array(t).map((function(e){})))),n)},RefreshChatListAsync:function(e,t){var a=this;return L()(D.a.mark((function e(){var n;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(se("/chats"));case 2:return e.next=4,e.sent.json();case 4:n=e.sent,t({type:a.Types.REFRESH_CHAT_LIST,data:n});case 6:case"end":return e.stop()}}),e)})))()},FetchLibraryPlayListsAsync:function(e,t){var a=this;return L()(D.a.mark((function e(){var n;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,MusicKit.getInstance().api.library.playlists();case 2:n=e.sent,console.log(n),t({type:a.Types.UPDATE_LIBRARY_PLAYLISTS,data:n});case 5:case"end":return e.stop()}}),e)})))()},SendMessageAsync:function(e,t,a){var n=this;return L()(D.a.mark((function r(){var i,c;return D.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return null==localStorage.getItem("UserId")&&localStorage.setItem("UserId",ce.a()),c=localStorage.getItem("UserId"),null==(null===(i=t.User)||void 0===i?void 0:i.Id)&&a({type:n.Types.UPDATE_USER_ID,data:localStorage.getItem("UserId")}),r.next=5,fetch(se("/message/send"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Text:e,SenderId:c,SenderName:c,ChatID:t.CurrentChat.Id})});case 5:case"end":return r.stop()}}),r)})))()},UpdateCurrentChatWindowShow:function(e,t,a){a({type:this.Types.UPDATE_CURRENT_CHAT_SHOW,data:{ID:e,Show:t}})}},le=function(){var e,t,a,i,c,s=Object(n.useContext)(j),o=s.state,l=s.dispatch;return r.a.createElement(q.a,{className:"popup-library-playlist",swipeToClose:!0},r.a.createElement(w.a,null,r.a.createElement(F.a,{title:"Songs"},r.a.createElement(X.a,null,r.a.createElement(Q.a,{popupClose:!0},"Close"))),r.a.createElement(G.a,{onClick:L()(D.a.mark((function e(){var t,a,n,r,i,c,s,u,d,p,h;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(null===(t=o.OpenedPlaylist)||void 0===t||null===(a=t.Playlist)||void 0===a||null===(n=a.relationships)||void 0===n||null===(r=n.tracks)||void 0===r?void 0:r.data),null==o.OpenedPlaylist.Playlist){e.next=7;break}return h=null===(i=o.OpenedPlaylist)||void 0===i||null===(c=i.Playlist)||void 0===c||null===(s=c.relationships)||void 0===s||null===(u=s.tracks)||void 0===u||null===(d=u.data)||void 0===d?void 0:d.map((function(e){var t,a,n;return{SID:null===(t=e.attributes)||void 0===t||null===(a=t.playParams)||void 0===a?void 0:a.catalogId,Duration:e.attributes.durationInMillis/1e3,Name:null===(n=e.attributes)||void 0===n?void 0:n.name}})).filter((function(e){return null!=e.SID})),console.log(h),e.next=6,oe.CreateChatAsync(h,null===(p=o.OpenedPlaylist)||void 0===p?void 0:p.Playlist.attributes.name,o,l);case 6:H.a.popup.close(".popup-library-playlist");case 7:case"end":return e.stop()}}),e)})))},"播放"),r.a.createElement(z.a,{mediaList:!0},null===(e=o.OpenedPlaylist)||void 0===e||null===(t=e.Playlist)||void 0===t||null===(a=t.relationships)||void 0===a||null===(i=a.tracks)||void 0===i||null===(c=i.data)||void 0===c?void 0:c.map((function(e){var t,a,n;return(r.a.createElement(V.a,{key:e.id,title:null==e||null===(t=e.attributes)||void 0===t?void 0:t.name},r.a.createElement("img",{style:{width:"80px",height:"80px"},slot:"media",src:null===(a=e.attributes)||void 0===a||null===(n=a.artwork)||void 0===n?void 0:n.url.replace("{w}x{h}","80x80"),alt:""})))})))))},ue=function(){var e=Object(n.useContext)(j),t=e.state,a=e.dispatch;return Object(n.useEffect)((function(){oe.FetchLibraryPlayListsAsync(t,a)}),[]),r.a.createElement(re,{title:"我的"},r.a.createElement(G.a,{onClick:L()(D.a.mark((function e(){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe.FetchLibraryPlayListsAsync(t,a);case 2:case"end":return e.stop()}}),e)})))},"刷新"),r.a.createElement(z.a,{mediaList:!0},t.My.LibraryPlaylists.map((function(e){var t,n;return(r.a.createElement(V.a,{title:e.attributes.name,key:e.id,popupOpen:".popup-library-playlist",onClick:L()(D.a.mark((function t(){return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,oe.OpenPlaylistAsync(e.id,a);case 2:case"end":return t.stop()}}),t)}))),link:"#"},r.a.createElement("img",{style:{width:"80px",height:"80px"},slot:"media",src:null===(t=e.attributes)||void 0===t||null===(n=t.artwork)||void 0===n?void 0:n.url,alt:""})))}))),r.a.createElement(le,null))},de=function(){var e=Object(n.useContext)(j),t=e.state,a=e.dispatch;Object(n.useEffect)((function(){oe.RefreshChatListAsync(10,a)}),[]);var i=Object(n.useRef)(!0),c=Object(n.useState)(!0),s=O()(c,2),o=s[0],l=s[1];return r.a.createElement(re,{title:"聊聊"},r.a.createElement(w.a,{ptr:!0,ptrMousewheel:!0,onPtrRefresh:function(e){console.log(123),oe.RefreshChatListAsync(10,a),e()},infinite:!0,infiniteDistance:50,infinitePreloader:o,onInfinite:function(){console.log("load"),i.current&&(i.current=!1,l(!1))}},r.a.createElement(Z.a,null,"聊聊， 下拉刷新"),r.a.createElement(G.a,{onClick:function(){MusicKit.getInstance().authorize()}},"登录 Apple Music"),r.a.createElement(z.a,{mediaList:!0},t.ChatList.map((function(e){return r.a.createElement(V.a,{onClick:function(){var n;(null===(n=t.CurrentChat)||void 0===n?void 0:n.Id)!=e.ID?(oe.JoinChat(e.ID,a),oe.UpdateCurrentChatWindowShow(e.ID,!0,a)):oe.UpdateCurrentChatWindowShow(e.ID,!0,a)},link:"#",title:e.Name,subtitle:"music name"},r.a.createElement("img",{slot:"media",src:"https://2gether.video/logo.png",width:"80"}))})))))},pe=(a(173),a(174),a(58)),he=a(59),me=a(60),fe=a(61),ve=function(){var e,t,a=Object(n.useContext)(j),i=a.state,c=a.dispatch,s=Object(n.useState)(""),o=O()(s,2),l=o[0],u=o[1],d=function(){var e=L()(D.a.mark((function e(){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(l.length>0)){e.next=4;break}return e.next=3,oe.SendMessageAsync(l,i,c);case 3:u("");case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(w.a,{noToolbar:!0,className:"chat-page"},r.a.createElement(pe.a,{value:l,onInput:function(e){return u(e.target.value)}},r.a.createElement(Q.a,{iconIos:"f7:arrow_up_circle_fill",iconAurora:"f7:arrow_up_circle_fill",iconMd:"material:send",slot:"inner-end",onClick:d})),r.a.createElement(he.a,null,r.a.createElement(me.a,null),null===(e=i.CurrentChat)||void 0===e||null===(t=e.Messages)||void 0===t?void 0:t.map((function(e,t){var a;return(r.a.createElement(fe.a,{key:t,type:e.SenderId==(null===(a=i.User)||void 0===a?void 0:a.Id)?"sent":"received",name:e.SenderId,first:!0,last:!0,tail:!0},e.Text&&r.a.createElement("span",{slot:"text"},e.Text)))}))))},ye=a(8),ge=a(62),Ee=[{path:"/",component:function(){var e=Object(n.useState)("chat-list"),t=O()(e,2),a=t[0],i=t[1],c=Object(n.useRef)(null);Object(n.useEffect)((function(){c.current=a}),[a]),Object(n.useEffect)((function(){if((H.a.device.ios||H.a.device.android)&&H.a.device.standalone){var e=document.querySelector('meta[name="viewport"]').getAttribute("content");document.querySelector('meta[name="viewport"]').setAttribute("content","".concat(e,", maximum-scale=1, user-scalable=no"))}}),[]);function s(e){c.current===a&&a===e&&Object(ye.default)("#view-".concat(e))[0].f7View.router.back()}return(ee.init(),r.a.createElement(w.a,null,r.a.createElement(ge.a,{tabs:!0,className:"safe-areas"},r.a.createElement(A.a,{tabbar:!0,labels:!0,bottom:!0},r.a.createElement(Q.a,{onClick:function(){return s("search")},tabLink:"#view-chat-list",iconF7:"chat_bubble_2_fill",text:"聊聊",tabLinkActive:!0}),r.a.createElement(Q.a,{onClick:function(){return s("apps")},tabLink:"#view-apps",iconF7:"music_house",text:"瞬间"}),r.a.createElement(Q.a,{onClick:function(){return s("arcade")},tabLink:"#view-arcade",iconF7:"person_crop_circle",text:"我的"})),r.a.createElement(W.a,{id:"view-apps",onTabShow:function(){return i("apps")},tab:!0,url:"/apps/"}),r.a.createElement(W.a,{id:"view-arcade",onTabShow:function(){return i("arcade")},tab:!0,url:"/arcade/"}),r.a.createElement(W.a,{id:"view-chat-list",onTabShow:function(){return i("chat-list")},main:!0,tabActive:!0,tab:!0,url:"/chat-list/"}))))}},{path:"/chat/(.*)",component:ve},{path:"/apps/",component:ie},{path:"/arcade/",component:ue},{path:"/chat-list/",component:de},{path:"/app/:id",asyncComponent:function(){return a.e(3).then(a.bind(null,183))}},{path:"/account/",popup:{asyncComponent:function(){return a.e(1).then(a.bind(null,181))}}},{path:"(.*)",asyncComponent:function(){return a.e(0).then(a.bind(null,182))}}];function Ce(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Te(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ce(Object(a),!0).forEach((function(t){N()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ce(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function be(e,t){var a=t.type;switch(a){case oe.Types.UPDATE_CURRENT_CHAT_DETAIL:case oe.Types.APPEND_CURRENT_CHAT_MESSAGE:case oe.Types.UPDATE_CURRENT_CHAT_SHOW:var n;if(t.data.ID!=(null===(n=e.CurrentChat)||void 0===n?void 0:n.Id))return e}switch(a){case oe.Types.REFRESH_CHAT_LIST:return Te({},e,{ChatList:t.data});case"FETCH_MORE_CHAT_LIST":return Te({},e,{ChatList:[].concat(M()(e.ChatList),[{},{},{},{},{},{},{},{},{},{}])});case oe.Types.JOIN_CHAT:var r,i;if(null!=(null===(r=e.CurrentChat)||void 0===r?void 0:r.ScheduledTaskId))clearInterval(null===(i=e.CurrentChat)||void 0===i?void 0:i.ScheduledTaskId);return Te({},e,{CurrentChat:{Id:t.data.Id,ScheduledTaskId:t.data.ScheduledTaskId}});case oe.Types.OPEN_PLAYLIST:return Te({},e,{OpenedPlaylist:{Id:t.data,Loadding:!0,Playlist:null}});case oe.Types.UPDATE_CURRENT_OPNED_PLAYLIST:return Te({},e,{OpenedPlaylist:{Id:t.data,Loadding:!1,Playlist:t.data}});case oe.Types.UPDATE_CURRENT_CHAT_DETAIL:return Te({},e,{CurrentChat:Te({},e.CurrentChat,{Id:t.data.ID,LastUpdateTimestamp:t.data.LastUpdateTimestamp,HeadTimestamp:t.data.HeadTimestamp,Name:t.data.Name,Songs:t.data.Songs})});case oe.Types.APPEND_CURRENT_CHAT_MESSAGE:var c,s,o,l,u;return(null===(c=t.data)||void 0===c||null===(s=c.Messages)||void 0===s?void 0:s.length)>0?(null===(o=e.CurrentChat.Messages)||void 0===o?void 0:o.length)>0&&e.CurrentChat.Messages.at(-1).ID>=t.data.Messages[0].ID?e:Te({},e,{CurrentChat:Te({},e.CurrentChat,{Messages:[].concat(M()((null==e||null===(l=e.CurrentChat)||void 0===l?void 0:l.Messages)?null==e||null===(u=e.CurrentChat)||void 0===u?void 0:u.Messages:[]),M()(t.data.Messages))})}):e;case"EXIT_CHAT":var d,p;if(null!=(null===(d=e.CurrentChat)||void 0===d?void 0:d.ScheduledTaskId))clearInterval(null===(p=e.CurrentChat)||void 0===p?void 0:p.ScheduledTaskId);return MusicKit.getInstance().player.pause(),MusicKit.getInstance().setQueue({}),Te({},e,{CurrentChat:null});case oe.Types.UPDATE_CURRENT_CHAT_SHOW:return console.log(t.data.Show,H.a.views.current.router.history),t.data.Show?H.a.views.current.router.navigate("/chat/"):H.a.views.current.router.back(),console.log(t.data.Show,H.a.views.current.router.history),Te({},e,{CurrentChat:Te({},e.CurrentChat,{MessageWindowShow:t.data.Show})});case oe.Types.UPDATE_CHAT_LIST:return Te({},e,{ChatList:t.data});case oe.Types.UPDATE_LIBRARY_PLAYLISTS:return Te({},e,{My:Te({},e.My,{LibraryPlaylists:t.data})});case oe.Types.UPDATE_MUSIC_PLAYER_DETAIL:return Te({},e,{MusicPlayer:t.data});case oe.Types.UPDATE_USER_ID:return Te({},e,{User:Te({},e.User,{Id:t.data})})}}var Ie=function(){var e,t,a,i,c,s,o,l=Object(n.useReducer)(be,{ChatList:[],My:{LibraryPlaylists:[]}}),u=O()(l,2),d=u[0],p=u[1],h=Object(n.useRef)(d);h.current=d;Object(n.useRef)(null);Object(n.useEffect)((function(){setInterval((function(){var e,t,a,n,r,i;oe.UpdateMusicPlayerDetail(MusicKit.getInstance().player.currentPlaybackTime/MusicKit.getInstance().player.currentPlaybackDuration*100,null===(e=MusicKit.getInstance().player.nowPlayingItem)||void 0===e||null===(t=e.attributes)||void 0===t?void 0:t.name,null===(a=MusicKit.getInstance().player.nowPlayingItem)||void 0===a||null===(n=a.attributes)||void 0===n||null===(r=n.artwork)||void 0===r||null===(i=r.url)||void 0===i?void 0:i.replace("{w}x{h}","96x96"),p)}),1e3)}),[]),Object(n.useEffect)((function(){if((H.a.device.ios||H.a.device.android)&&H.a.device.standalone){var e=document.querySelector('meta[name="viewport"]').getAttribute("content");document.querySelector('meta[name="viewport"]').setAttribute("content","".concat(e,", maximum-scale=1, user-scalable=no"))}}),[]);var m={name:"App Store",theme:"ios",routes:Ee,autoDarkTheme:!0,navbar:{scrollTopOnTitleClick:!1}};return ee.init(),Object(n.useEffect)(L()(D.a.mark((function e(){var t,a,n,r;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=function(){return(r=L()(D.a.mark((function e(){var t,a,r,i,c,s,o,l,u,d,p,m,f,v,y,g,E,C,T,b,I,_,w,A=arguments;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=A.length>0&&void 0!==A[0]&&A[0],MusicKit.getInstance().player._next=function(){n(!1)},t&&setTimeout((function(){return n(!0)}),1e3),e.prev=3,i=null===(a=h.current.CurrentChat)||void 0===a?void 0:a.HeadTimestamp,c=null===(r=h.current.CurrentChat)||void 0===r?void 0:r.Songs,s=0;case 7:if(!((null==c?void 0:c.length)>0)){e.next=45;break}if(o=s%(null==c?void 0:c.length),!(i+c[o].Duration>Date.now()/1e3)){e.next=41;break}if((null===(l=MusicKit.getInstance().player.nowPlayingItem)||void 0===l||null===(u=l.attributes)||void 0===u||null===(d=u.playParams)||void 0===d?void 0:d.id)==c[o].SID){e.next=25;break}if(!MusicKit.getInstance().player._dontreconfigure){e.next=13;break}return e.abrupt("return");case 13:return console.log("configure"),setTimeout((function(){MusicKit.getInstance().player._dontreconfigure=!1}),1e4),MusicKit.getInstance().player._dontreconfigure=!0,console.log("change",null===(p=MusicKit.getInstance().player.nowPlayingItem)||void 0===p||null===(m=p.attributes)||void 0===m||null===(f=m.playParams)||void 0===f?void 0:f.id,c[o]),E=Date.now(),e.next=20,MusicKit.getInstance().setQueue({song:c[o].SID});case 20:return e.next=22,MusicKit.getInstance().player.changeToMediaAtIndex(0);case 22:MusicKit.getInstance().player._dontreconfigure=!1,C=Date.now(),console.log("change time",C-E,null===(v=MusicKit.getInstance().player.nowPlayingItem)||void 0===v||null===(y=v.attributes)||void 0===y||null===(g=y.playParams)||void 0===g?void 0:g.id);case 25:if(MusicKit.getInstance().player.currentBufferedProgress*MusicKit.getInstance().player.currentPlaybackDuration/100>Date.now()/1e3-i&&Math.abs(MusicKit.getInstance().player._currentPlayer.audio.currentTime-(Date.now()/1e3-i))>1.5){console.log("seek",Date.now()/1e3-i),T=Date.now();try{MusicKit.getInstance().player._currentPlayer.audio.currentTime=Date.now()/1e3-i}catch(e){console.error(e)}b=Date.now(),console.log("seek time ",b-T)}if(MusicKit.getInstance().player.isPlaying){e.next=38;break}return I=Date.now(),e.prev=28,e.next=31,MusicKit.getInstance().player.play();case 31:e.next=36;break;case 33:e.prev=33,e.t0=e.catch(28),console.error(e.t0);case 36:_=Date.now(),console.log("play time ",_-I);case 38:return e.abrupt("break",45);case 41:i+=null===(w=h.current.CurrentChat)||void 0===w?void 0:w.Songs[o].Duration;case 42:s++,e.next=7;break;case 45:e.next=50;break;case 47:e.prev=47,e.t1=e.catch(3),console.error(e.t1);case 50:case"end":return e.stop()}}),e,null,[[3,47],[28,33]])})))).apply(this,arguments)},n=function(){return r.apply(this,arguments)},a=function(){return(a=L()(D.a.mark((function e(){var a,n,r,i;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{i=localStorage.getItem("UserId"),null==(null===(a=d.User)||void 0===a?void 0:a.Id)&&null!=i&&p({type:oe.Types.UPDATE_USER_ID,data:localStorage.getItem("UserId")}),null!=(null===(n=h.current)||void 0===n||null===(r=n.CurrentChat)||void 0===r?void 0:r.Id)&&(null==h.current.CurrentChat.Messages||0==h.current.CurrentChat.Messages.length?oe.FetchMessageAsync(h.current.CurrentChat.Id,-2,p):oe.FetchMessageAsync(h.current.CurrentChat.Id,h.current.CurrentChat.Messages.at(-1).ID,p))}finally{setTimeout(t,1e3)}case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)},(t=function(){return a.apply(this,arguments)})(),document.addEventListener("click",(function(){return n(!1)})),MusicKit.getInstance().player.__next=MusicKit.getInstance().player._next,n(!0);case 8:case"end":return e.stop()}}),e)}))),[]),r.a.createElement(K.a,m,r.a.createElement(j.Provider,{value:{state:d,dispatch:p}},r.a.createElement(W.a,{url:"/"},d.CurrentChat?r.a.createElement(F.a,{scrollTopOnTitleClick:!1,className:"chat-music-navbar"},r.a.createElement("div",{className:"title",style:{width:"100%"}},r.a.createElement(Y.a,{noGap:!0,className:"chat-music-player",style:{display:"flex"}},r.a.createElement("img",{slot:"media",src:null===(e=d.MusicPlayer)||void 0===e?void 0:e.Image,width:"96px",height:"96px"}),r.a.createElement(Y.a,{noGap:!0,style:{width:"0px"}},r.a.createElement(J.a,{width:"100",style:{height:"96px"}},r.a.createElement(Y.a,{noGap:!0,style:{height:"92px"}},r.a.createElement(J.a,{width:"50",style:{overflow:"hidden"}},r.a.createElement("p",null," ",null===(t=d.CurrentChat)||void 0===t?void 0:t.Name," "),r.a.createElement("p",null,null===(a=d.MusicPlayer)||void 0===a?void 0:a.Name)),r.a.createElement(J.a,{width:"50",style:{height:"92px"}},r.a.createElement(Y.a,{noGap:!0,style:{height:"56px"}}),r.a.createElement(Y.a,{noGap:!0,style:{height:"36px"}},r.a.createElement(J.a,{width:"25"},r.a.createElement(G.a,{color:"red",iconF7:"xmark",onClick:function(){console.log(H.a.views.current.router.back()),p({type:"EXIT_CHAT"})}})),r.a.createElement(J.a,{width:"25"},r.a.createElement(G.a,{iconF7:"person_2_fill",popupOpen:".chat-member-list"})),r.a.createElement(J.a,{width:"25"},r.a.createElement(G.a,{iconF7:"list_number",popupOpen:".chat-music-list"})),r.a.createElement(J.a,{width:"25"},r.a.createElement(G.a,{onClick:function(){var e;(null===(e=d.CurrentChat)||void 0===e?void 0:e.MessageWindowShow)?oe.UpdateCurrentChatWindowShow(d.CurrentChat.Id,!1,p):oe.UpdateCurrentChatWindowShow(d.CurrentChat.Id,!0,p)},iconF7:"chat_bubble_fill",fill:null===(i=d.CurrentChat)||void 0===i?void 0:i.MessageWindowShow}))))),r.a.createElement(Y.a,{style:{height:"4px"}},r.a.createElement(B.a,{style:{height:"4px"},progress:null===(c=d.MusicPlayer)||void 0===c?void 0:c.Progress,id:"chat-music-player-progressbar"}))))))):null,r.a.createElement(q.a,{className:"chat-music-list",swipeToClose:!0},r.a.createElement(w.a,null,r.a.createElement(F.a,{title:"播放列表"},r.a.createElement(X.a,null,r.a.createElement(Q.a,{popupClose:!0},"Close"))),r.a.createElement(z.a,{mediaList:!0},null===(s=d.CurrentChat)||void 0===s||null===(o=s.Songs)||void 0===o?void 0:o.map((function(e){return r.a.createElement(V.a,{title:e.Name})}))))),r.a.createElement(q.a,{className:"chat-member-list",swipeToClose:!0},r.a.createElement(w.a,null,r.a.createElement(F.a,{title:"chat-member-list"},r.a.createElement(X.a,null,r.a.createElement(Q.a,{popupClose:!0},"Close"))),r.a.createElement(Z.a,null,"Coming soon"))))))};P.use(s.a),c.a.render(r.a.createElement(Ie),document.getElementById("app"))},52:function(e,t,a){e.exports=a.p+"images/avatar.ffc8a1.jpeg"},87:function(e,t,a){"use strict";var n=a(0),r=a.n(n);a(172);t.a=function(e){var t=e.title,a=e.children;return(r.a.createElement("div",{className:"block-title appstore-block-title"},t&&r.a.createElement("span",null,t),a))}}});
//# sourceMappingURL=app.317e07.js.map